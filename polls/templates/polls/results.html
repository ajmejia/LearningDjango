{% extends "base_template.html" %}
{% load staticfiles %}

{% block add_styles %}
	<link rel="stylesheet" type="text/css" href="{% static 'polls/css/results_style.css' %}">
{% endblock %}

{% block flash_messages_block %}
	{% with flash_messages=messages %}
		{% for message in flash_messages %}
			<div class="{{ message.tags }}">{{ message }}</div>
		{% endfor %}
	{% endwith %}
{% endblock %}

{% block page_title %}{{ question.question }}{% endblock %}

{% block page_body %}

	<table data-total="{{ question.get_total_votes }}">
		<tr>
	    <th id="choices-head">Choices</th>
	    <th id="votes-head">Votes (%)</th>
		</tr>

	  <tr>
	    <td class="choice-col"></td>
	    <td class="bin-empty">
	      <div class="scale">
	        <span class="start">0%</span>
	        <span class="half">50%</span>
	        <span class="full">100%</span>
	      </div>
	    </td>
	  </tr>
		{% for choice in question.choice_set.all %}
			<tr>
				<td class="choice-col">{{ choice.choice }}</td>
				<td class="bin-col"><div data-votes="{{ choice.votes }}" id="choice_{{ choice.id }}" class="bin"></div></td>
			</tr>
		{% endfor %}
	</table>
	</br>
	<a href="{% url 'polls:index' %}" class="go-back">Go back</a>
{% endblock %}

{% block js %}
	<script>
		$(function() {
		  var $table = $("table");
		  
		  var $total_votes = $table.data("total");
		  var $bin_ids = $(".bin").map(function(i, bin){
				return "#"+bin.id;
			});
		  $bin_ids.each(function(i, id){
					$(id).animate({"width":($(id).data("votes")/$total_votes*100)+"%"}, 2000);
				});
		});
	</script>
{% endblock %}
